// Prisma Schema for Spin the Wheel Application
// Database: PostgreSQL

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Tenant represents a business account (restaurant, store, etc.)
model Tenant {
  id              String   @id @default(uuid())
  name            String   // Business name
  ownerName       String
  email           String   @unique
  password        String   // Hashed password
  status          String   @default("Active") // Active, Trial, Suspended
  logo            String?
  primaryColor    String   @default("#2bbdee")
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  prizes          Prize[]
  users           User[]
  spinConfig      SpinConfiguration?
  spinHistory     SpinHistory[]
  contactRequests ContactRequest[]

  @@map("tenants")
}

// Prize configured by tenant
model Prize {
  id          String   @id @default(uuid())
  tenantId    String
  name        String
  type        String   // Food Item, Discount, Merchandise, Voucher
  description String
  status      String   @default("Active") // Active, Inactive
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, name])
  @@map("prizes")
}

// End users who spin the wheel (customers)
model User {
  id         String   @id @default(uuid())
  tenantId   String
  name       String
  email      String
  avatar     String?
  plan       String   @default("Basic") // Basic, Premium
  status     String   @default("Active") // Active, Inactive, Pending
  dateJoined DateTime @default(now())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  tenant     Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, email])
  @@map("users")
}

// Spin wheel customization per tenant
model SpinConfiguration {
  id                String   @id @default(uuid())
  tenantId          String   @unique
  wheelColors       String[] // Array of color codes
  spinDuration      Int      @default(5000) // milliseconds
  soundEnabled      Boolean  @default(true)
  showConfetti      Boolean  @default(true)
  customMessage     String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  tenant            Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("spin_configurations")
}

// Record of all spins
model SpinHistory {
  id         String   @id @default(uuid())
  tenantId   String
  userName   String?  // Name of person who spun
  userEmail  String?  // Email of person who spun
  prizeWon   String   // Name of prize won
  timestamp  DateTime @default(now())

  // Relations
  tenant     Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("spin_history")
}

// Contact requests for custom experiences
model ContactRequest {
  id                String   @id @default(uuid())
  tenantId          String?  // Optional - for logged-in users, null for public inquiries
  name              String
  email             String
  phone             String?
  message           String
  requestType       String   // New Experience, Customization, Support
  status            String   @default("Pending") // Pending, In Review, Quoted, Accepted, Rejected
  estimatedCost     Float?
  estimatedTimeframe String?
  adminNotes        String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  tenant            Tenant?  @relation(fields: [tenantId], references: [id], onDelete: SetNull)

  @@map("contact_requests")
}
